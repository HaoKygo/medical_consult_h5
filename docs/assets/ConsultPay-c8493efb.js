import{_ as T}from"./McPaySheet-ee088482.js";import{d as V,n as $,r as c,l as N,N as M,o as s,e as b,c as n,h as a,t as O,s as l,w as h,k as i,u as R,i as U,v as A,p as E,f as F}from"./index-f0f6f9be.js";import{S as G}from"./index-626ee2c2.js";import{C as L}from"./index-ed2b3261.js";import{C as j}from"./index-ce0c6966.js";import{C as q}from"./index-83df3ea3.js";import{_ as z}from"./McNavBar-2e5a783f.js";import{_ as H}from"./avatar-doctor-b295eb9f.js";import{b as J,c as K}from"./consult-47f37c38.js";import{f as Q}from"./user-c4d80d2e.js";import{a as W,s as X}from"./function-call-b54e629e.js";import{s as Y}from"./request-b35c56a1.js";import{_ as Z}from"./plugin-vueexport-helper-c27b6911.js";import"./McIcon-90cb4441.js";import"./index-c4e2e87f.js";import"./index-acdd4ec3.js";import"./use-route-07e5c62b.js";import"./use-placeholder-15e8b99b.js";import"./index-801c1e82.js";import"./interceptor-6fa9ba49.js";const d=p=>(E("data-v-b05bfee2"),p=p(),F(),p),ee={key:0,class:"consult-pay-page"},te={class:"pay-info"},oe={key:0,class:"title"},ae=d(()=>a("img",{src:H,alt:"doctor avatar"},null,-1)),se=d(()=>a("p",{class:"desc"},[a("span",null,"极速问诊"),a("span",null,"自动分配医生")],-1)),le=d(()=>a("div",{class:"pay-space"},null,-1)),ne={class:"pay-schema"},ue=d(()=>a("span",{class:"text"},"支付协议",-1)),re=V({__name:"ConsultPay",setup(p){const o=$(),C=A(),e=c(),P=async()=>{try{const t=await J({type:o.consult.type,illnessType:o.consult.illnessType});e.value=t,e.value.couponId&&o.setCoupon(e.value.couponId)}catch{W({title:"温馨提示",message:"问诊信息不完整请重新填写，如果未支付可以去记录继续支付"}),C.push("/home")}},u=c(),k=async()=>{if(!o.consult.patientId)return;const t=await Q(o.consult.patientId);u.value=t};N(()=>{P(),k()});const v=c(!1),y=c(!1),m=c(""),w=async()=>{if(!v.value)return Y("请勾选我已同意支付协议");try{const t=await K(o.consult);m.value=t.id,o.clearConsult(),y.value=!0}catch(t){console.log(t)}};M(()=>{if(m.value)return!1});const x=async()=>X({title:"关闭支付",message:"取消支付将无法获得医生回复，医生接诊名额有限，是否确认关闭？",cancelButtonText:"仍要关闭",confirmButtonText:"继续支付",confirmButtonColor:"var(--mc-primary)"}).then(()=>!1).catch(()=>(m.value="",C.push("/user/consult"),!0));return(t,_)=>{const I=z,r=q,g=j,S=L,B=G,D=T;return e.value?(s(),b("div",ee,[n(I,{middleTitle:"支付"}),a("div",te,[e.value.payment?(s(),b("p",oe,O(`图文问诊 ${e.value.payment} 元`),1)):l("",!0),ae,se]),n(g,null,{default:h(()=>[e.value.couponDeduction?(s(),i(r,{key:0,title:"优惠券",value:`-¥${e.value.couponDeduction}`},null,8,["value"])):l("",!0),e.value.pointDeduction?(s(),i(r,{key:1,title:"积分抵扣",value:`-¥${e.value.pointDeduction}`},null,8,["value"])):l("",!0),e.value.actualPayment?(s(),i(r,{key:2,title:"实付款",value:`¥${e.value.actualPayment}`,class:"pay-price"},null,8,["value"])):l("",!0)]),_:1}),le,n(g,null,{default:h(()=>[u.value?(s(),i(r,{key:0,title:"患者信息",value:`${u.value.name} | ${u.value.genderValue} | ${u.value.age}岁`},null,8,["value"])):l("",!0),n(r,{title:"病情描述",label:R(o).consult.illnessDesc},null,8,["label"])]),_:1}),a("div",ne,[n(S,{modelValue:v.value,"onUpdate:modelValue":_[0]||(_[0]=f=>v.value=f)},{default:h(()=>[U(" 我已同意 "),ue]),_:1},8,["modelValue"])]),e.value.actualPayment?(s(),i(B,{key:0,onClick:w,price:e.value.actualPayment*100,textAlign:"left",buttonType:"primary",buttonText:"立刻支付"},null,8,["price"])):l("",!0),n(D,{show:y.value,"onUpdate:show":_[1]||(_[1]=f=>y.value=f),orderId:m.value,onClose:x,"actual-payment":e.value.actualPayment},null,8,["show","orderId","actual-payment"])])):l("",!0)}}});const De=Z(re,[["__scopeId","data-v-b05bfee2"]]);export{De as default};
