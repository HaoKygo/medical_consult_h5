import{d as M,r as c,l as N,o as i,e as m,c as a,h as e,t as r,F as L,j as R,w as k,k as x,s as I,i as P,y as U,p as j,f as q}from"./index-89f95841.js";import{S as A}from"./index-3e0d1bb2.js";import{_ as z}from"./McPaySheet-9c46c126.js";import{S as E}from"./index-a5dabe16.js";import{C as G}from"./index-21e31875.js";import{C as H}from"./index-d5df6925.js";import{C as J}from"./index-58e3ae5a.js";import{T as K}from"./index-0e73ba85.js";import{_ as Q}from"./McNavBar-6d2b9b42.js";import{g as W,a as X,c as Y}from"./medicine-e9ac707f.js";import{s as v}from"./request-64361350.js";import{I as Z}from"./index-3ac92062.js";import{I as ee}from"./index-f69948ed.js";import{_ as ae}from"./plugin-vueexport-helper-c27b6911.js";import"./McIcon-1c305fdc.js";import"./consult-cdcff422.js";import"./index-cbbe86d0.js";import"./use-route-fce4f8c0.js";import"./use-placeholder-79b597dc.js";import"./interceptor-9d6b5497.js";const w=d=>(j("data-v-4e4e70c8"),d=d(),q(),d),te={key:0,class:"order-pay-page"},oe={class:"order-address"},se={class:"area"},le={class:"detail"},ne={class:"order-medicines"},re=w(()=>e("div",{class:"head"},[e("h3",null,"优医药房"),e("small",null,"优医质保 假一赔十")],-1)),ce={class:"info"},ie={class:"name"},ue={class:"size"},de={class:"price"},pe={class:"desc"},_e={class:"order-detail"},me={class:"order-tip"},ve=w(()=>e("p",{class:"tip"}," 由于药品的特殊性，如非错发、漏发药品的情况，药品一经发出 不得退换，请核对药品信息无误后下单。 ",-1)),fe=w(()=>e("a",{href:"javascript:;"},"支付协议",-1)),ye={key:1,class:"order-pay-page"},he=M({__name:"OrderPay",setup(d){const C=U(),t=c(),l=c();N(async()=>{const u=await W({prescriptionId:C.query.id}),s=await X();if(t.value=u,s.length){const n=s.find(g=>g.isDefault===1);l.value=n||s[0]}});const f=c(!1),y=c(!1),p=c(!1),h=c(""),S=async()=>{var u,s;if(!f.value)return window.scrollTo(0,document.body.scrollHeight),v("请同意支付协议");if(!((u=l.value)!=null&&u.id))return window.scrollTo(0,0),v("请选择收货地址");if(!((s=t.value)!=null&&s.id))return v("未找到处方");if(h.value)p.value=!0;else{y.value=!0;try{const n=await Y({id:t.value.id,addressId:l.value.id});h.value=n.id,p.value=!0}catch(n){console.log(n),v("生成订单失败")}finally{y.value=!1}}},T="https://haokygo.github.io/medical_consult_h5/#/medicine/pay/result";return(u,s)=>{const n=Q,g=Z,$=ee,B=K,_=J,V=H,D=G,O=E,F=z,b=A;return t.value&&l.value?(i(),m("div",te,[a(n,{middleTitle:"药品支付"}),e("div",oe,[e("p",se,[a(g,{name:"location"}),e("span",null,r(l.value.province+l.value.city+l.value.county),1)]),e("p",le,r(l.value.addressDetail),1),e("p",null,r(l.value.receiver)+" "+r(l.value.mobile.replace(/^(\d{3})(?:\d{4})(\d{4})$/,"$1****$2")),1)]),e("div",ne,[re,(i(!0),m(L,null,R(t.value.medicines,o=>(i(),m("div",{class:"medicine van-hairline-top",key:o.id},[a($,{src:o.avatar,fit:"contain"},null,8,["src"]),e("div",ce,[e("p",ie,[e("span",null,r(o.name),1),e("span",null,"x"+r(o.quantity),1)]),e("p",ue,[o.prescriptionFlag===1?(i(),x(B,{key:0},{default:k(()=>[P("处方药")]),_:1})):I("",!0),e("span",null,r(o.specs),1)]),e("p",de,"¥"+r(o.amount),1)]),e("div",pe,r(o.usageDosag),1)]))),128))]),e("div",_e,[a(V,null,{default:k(()=>[a(_,{title:"药品金额",value:`¥${t.value.payment}`},null,8,["value"]),a(_,{title:"运费",value:`¥${t.value.expressFee}`},null,8,["value"]),t.value.couponDeduction?(i(),x(_,{key:0,title:"优惠券",value:`¥-${t.value.couponDeduction}`},null,8,["value"])):I("",!0),a(_,{title:"实付款",value:`￥${t.value.actualPayment}`,class:"price"},null,8,["value"])]),_:1})]),e("div",me,[ve,a(D,{modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=o=>f.value=o)},{default:k(()=>[P(" 我已同意"),fe]),_:1},8,["modelValue"])]),a(O,{onClick:S,loading:y.value,price:t.value.actualPayment*100,"button-text":"立即支付","button-type":"primary","text-align":"left"},null,8,["loading","price"]),a(F,{show:p.value,"onUpdate:show":s[1]||(s[1]=o=>p.value=o),orderId:h.value,actualPayment:t.value.actualPayment,payCallback:T},null,8,["show","orderId","actualPayment"])])):(i(),m("div",ye,[a(n,{middleTitle:"药品支付"}),a(b,{title:"",row:4,style:{"margin-top":"30px"}}),a(b,{title:"",row:4,style:{"margin-top":"30px"}})]))}}});const Ue=ae(he,[["__scopeId","data-v-4e4e70c8"]]);export{Ue as default};
