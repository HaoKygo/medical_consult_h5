import{d as F,r as c,l as M,o as i,e as m,c as a,h as e,t as r,F as N,j as L,w,k as I,s as P,i as b,y as R,p as j,f as q}from"./index-065e17f8.js";import{S as A}from"./index-13a874eb.js";import{_ as U}from"./McPaySheet-fef86b32.js";import{S as z}from"./index-f6985652.js";import{C as E}from"./index-05700f99.js";import{C as G}from"./index-24371fb5.js";import{C as H}from"./index-834d3738.js";import{T as J}from"./index-b3d53242.js";import{_ as K}from"./McNavBar-ba5c8ffd.js";import{g as Q,a as W,c as X}from"./medicine-89ac6a5d.js";import{s as v}from"./request-7d32c2d7.js";import{I as Y}from"./index-e7e15f08.js";import{I as Z}from"./index-5bbaee52.js";import{_ as ee}from"./_plugin-vue_export-helper-c27b6911.js";import"./McIcon-6ebf4c62.js";import"./consult-3dadaaaa.js";import"./index-3a701df8.js";import"./use-route-b6d29d8b.js";import"./use-placeholder-5af40b98.js";import"./interceptor-832f03c0.js";const k=d=>(j("data-v-8a225605"),d=d(),q(),d),ae={key:0,class:"order-pay-page"},te={class:"order-address"},oe={class:"area"},se={class:"detail"},le={class:"order-medicines"},ne=k(()=>e("div",{class:"head"},[e("h3",null,"优医药房"),e("small",null,"优医质保 假一赔十")],-1)),re={class:"info"},ce={class:"name"},ie={class:"size"},ue={class:"price"},de={class:"desc"},pe={class:"order-detail"},_e={class:"order-tip"},me=k(()=>e("p",{class:"tip"}," 由于药品的特殊性，如非错发、漏发药品的情况，药品一经发出 不得退换，请核对药品信息无误后下单。 ",-1)),ve=k(()=>e("a",{href:"javascript:;"},"支付协议",-1)),fe={key:1,class:"order-pay-page"},ye=F({__name:"OrderPay",setup(d){const C=R(),t=c(),l=c();M(async()=>{const u=await Q({prescriptionId:C.query.id}),s=await W();if(t.value=u,s.length){const n=s.find(g=>g.isDefault===1);l.value=n||s[0]}});const f=c(!1),y=c(!1),p=c(!1),h=c(""),S=async()=>{var u,s;if(!f.value)return window.scrollTo(0,document.body.scrollHeight),v("请同意支付协议");if(!((u=l.value)!=null&&u.id))return window.scrollTo(0,0),v("请选择收货地址");if(!((s=t.value)!=null&&s.id))return v("未找到处方");if(h.value)p.value=!0;else{y.value=!0;try{const n=await X({id:t.value.id,addressId:l.value.id});h.value=n.id,p.value=!0}catch(n){console.log(n),v("生成订单失败")}finally{y.value=!1}}};return(u,s)=>{const n=K,g=Y,T=Z,B=J,_=H,V=G,$=E,D=z,O=U,x=A;return t.value&&l.value?(i(),m("div",ae,[a(n,{middleTitle:"药品支付"}),e("div",te,[e("p",oe,[a(g,{name:"location"}),e("span",null,r(l.value.province+l.value.city+l.value.county),1)]),e("p",se,r(l.value.addressDetail),1),e("p",null,r(l.value.receiver)+" "+r(l.value.mobile.replace(/^(\d{3})(?:\d{4})(\d{4})$/,"$1****$2")),1)]),e("div",le,[ne,(i(!0),m(N,null,L(t.value.medicines,o=>(i(),m("div",{class:"medicine van-hairline-top",key:o.id},[a(T,{src:o.avatar,fit:"contain"},null,8,["src"]),e("div",re,[e("p",ce,[e("span",null,r(o.name),1),e("span",null,"x"+r(o.quantity),1)]),e("p",ie,[o.prescriptionFlag===1?(i(),I(B,{key:0},{default:w(()=>[b("处方药")]),_:1})):P("",!0),e("span",null,r(o.specs),1)]),e("p",ue,"¥"+r(o.amount),1)]),e("div",de,r(o.usageDosag),1)]))),128))]),e("div",pe,[a(V,null,{default:w(()=>[a(_,{title:"药品金额",value:`¥${t.value.payment}`},null,8,["value"]),a(_,{title:"运费",value:`¥${t.value.expressFee}`},null,8,["value"]),t.value.couponDeduction?(i(),I(_,{key:0,title:"优惠券",value:`¥-${t.value.couponDeduction}`},null,8,["value"])):P("",!0),a(_,{title:"实付款",value:`￥${t.value.actualPayment}`,class:"price"},null,8,["value"])]),_:1})]),e("div",_e,[me,a($,{modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=o=>f.value=o)},{default:w(()=>[b(" 我已同意"),ve]),_:1},8,["modelValue"])]),a(D,{onClick:S,loading:y.value,price:t.value.actualPayment*100,"button-text":"立即支付","button-type":"primary","text-align":"left"},null,8,["loading","price"]),a(O,{show:p.value,"onUpdate:show":s[1]||(s[1]=o=>p.value=o),orderId:h.value,actualPayment:t.value.actualPayment,payCallback:"http://localhost:5173/medicine/pay/result"},null,8,["show","orderId","actualPayment"])])):(i(),m("div",fe,[a(n,{middleTitle:"药品支付"}),a(x,{title:"",row:4,style:{"margin-top":"30px"}}),a(x,{title:"",row:4,style:{"margin-top":"30px"}})]))}}});const Re=ee(ye,[["__scopeId","data-v-8a225605"]]);export{Re as default};
