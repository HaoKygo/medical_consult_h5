import{d as ee,L as oe,u as te,P as ae,m as se,c as ne}from"./request-3192e86f.js";import{c as L,y as H,n as $,l as ie,p as W,a0 as p,a1 as le,t as R,S as ce,m as z,H as k,h as A,z as re,a2 as me,G as ue,v as ve,a3 as de,I as ge,f as fe,e as he}from"./index-de5b0c77.js";import{a as we,S as Pe}from"./index-ae3ba2f7.js";import{I as Se}from"./index-988c468f.js";import{d as O,D as F,r as G,a as Z,E as X,c,l as xe,G as Ie,m as j}from"./index-52c3ae66.js";import{c as ye}from"./interceptor-4b8a4ee2.js";const B=o=>Math.sqrt((o[0].clientX-o[1].clientX)**2+(o[0].clientY-o[1].clientY)**2),N=L("image-preview")[1];var Ce=O({props:{src:String,show:Boolean,active:Number,minZoom:H($),maxZoom:H($),rootWidth:H(Number),rootHeight:H(Number),disableZoom:Boolean},emits:["scale","close","longPress"],setup(o,{emit:l,slots:r}){const e=F({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),s=ee(),w=G(),I=Z(()=>{const{rootWidth:t,rootHeight:n}=o,i=n/t;return e.imageRatio>i}),Y=Z(()=>{const{scale:t,moveX:n,moveY:i,moving:g,zooming:f}=e,D={transitionDuration:f||g?"0s":".3s"};if(t!==1){const J=n/t,Q=i/t;D.transform=`scale(${t}, ${t}) translate(${J}px, ${Q}px)`}return D}),m=Z(()=>{if(e.imageRatio){const{rootWidth:t,rootHeight:n}=o,i=I.value?n/e.imageRatio:t;return Math.max(0,(e.scale*i-t)/2)}return 0}),v=Z(()=>{if(e.imageRatio){const{rootWidth:t,rootHeight:n}=o,i=I.value?n:t*e.imageRatio;return Math.max(0,(e.scale*i-n)/2)}return 0}),y=t=>{t=p(t,+o.minZoom,+o.maxZoom+1),t!==e.scale&&(e.scale=t,l("scale",{scale:t,index:o.active}))},C=()=>{y(1),e.moveX=0,e.moveY=0},M=()=>{const t=e.scale>1?1:2;y(t),e.moveX=0,e.moveY=0};let h,P,S,T,b,a,d,u=!1;const q=t=>{const{touches:n}=t;if(h=n.length,h===2&&o.disableZoom)return;const{offsetX:i}=s;s.start(t),P=e.moveX,S=e.moveY,d=Date.now(),u=!1,e.moving=h===1&&e.scale!==1,e.zooming=h===2&&!i.value,e.zooming&&(T=e.scale,b=B(t.touches))},U=t=>{const{touches:n}=t;if(s.move(t),e.moving){const{deltaX:i,deltaY:g}=s,f=i.value+P,D=g.value+S;if((f>m.value||f<-m.value)&&!u&&s.isHorizontal()){e.moving=!1;return}u=!0,W(t,!0),e.moveX=p(f,-m.value,m.value),e.moveY=p(D,-v.value,v.value)}if(e.zooming&&(W(t,!0),n.length===2)){const i=B(n),g=T*i/b;y(g)}},K=()=>{if(h>1)return;const{offsetX:t,offsetY:n}=s,i=Date.now()-d,g=250,f=5;t.value<f&&n.value<f&&(i<g?a?(clearTimeout(a),a=null,M()):a=setTimeout(()=>{l("close"),a=null},g):i>le&&l("longPress"))},_=t=>{let n=!1;if((e.moving||e.zooming)&&(n=!0,e.moving&&P===e.moveX&&S===e.moveY&&(n=!1),!t.touches.length)){e.zooming&&(e.moveX=p(e.moveX,-m.value,m.value),e.moveY=p(e.moveY,-v.value,v.value),e.zooming=!1),e.moving=!1,P=0,S=0,T=1,e.scale<1&&C();const i=+o.maxZoom;e.scale>i&&(e.scale=i)}W(t,n),K(),s.reset()},V=t=>{const{naturalWidth:n,naturalHeight:i}=t.target;e.imageRatio=i/n};return X(()=>o.active,C),X(()=>o.show,t=>{t||C()}),ie("touchmove",U,{target:Z(()=>{var t;return(t=w.value)==null?void 0:t.$el})}),()=>{const t={loading:()=>c(oe,{type:"spinner"},null)};return c(we,{ref:w,class:N("swipe-item"),onTouchstartPassive:q,onTouchend:_,onTouchcancel:_},{default:()=>[r.image?c("div",{class:N("image-wrap")},[r.image({src:o.src})]):c(Se,{src:o.src,fit:"contain",class:N("image",{vertical:I.value}),style:Y.value,onLoad:V},t)]})}}});const[Te,x]=L("image-preview"),be=["show","teleport","transition","overlayStyle","closeOnPopstate"],pe={show:Boolean,loop:R,images:ce(),minZoom:z(1/3),maxZoom:z(3),overlay:R,closeable:Boolean,showIndex:R,className:k,closeIcon:A("clear"),transition:String,beforeClose:Function,overlayClass:k,overlayStyle:Object,swipeDuration:z(300),startPosition:z(0),showIndicators:Boolean,closeOnPopstate:R,closeIconPosition:A("top-right"),teleport:[String,Object]};var Ze=O({name:Te,props:pe,emits:["scale","close","closed","change","longPress","update:show"],setup(o,{emit:l,slots:r}){const e=G(),s=F({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),w=()=>{if(e.value){const a=ve(e.value.$el);s.rootWidth=a.width,s.rootHeight=a.height,e.value.resize()}},I=a=>l("scale",a),Y=a=>l("update:show",a),m=()=>{ye(o.beforeClose,{args:[s.active],done:()=>Y(!1)})},v=a=>{a!==s.active&&(s.active=a,l("change",a))},y=()=>{if(o.showIndex)return c("div",{class:x("index")},[r.index?r.index({index:s.active}):`${s.active+1} / ${o.images.length}`])},C=()=>{if(r.cover)return c("div",{class:x("cover")},[r.cover()])},M=()=>{s.disableZoom=!0},h=()=>{s.disableZoom=!1},P=()=>c(Pe,{ref:e,lazyRender:!0,loop:o.loop,class:x("swipe"),duration:o.swipeDuration,initialSwipe:o.startPosition,showIndicators:o.showIndicators,indicatorColor:"white",onChange:v,onDragEnd:h,onDragStart:M},{default:()=>[o.images.map((a,d)=>c(Ce,{src:a,show:o.show,active:s.active,maxZoom:o.maxZoom,minZoom:o.minZoom,rootWidth:s.rootWidth,rootHeight:s.rootHeight,disableZoom:s.disableZoom,onScale:I,onClose:m,onLongPress:()=>l("longPress",{index:d})},{image:r.image}))]}),S=()=>{if(o.closeable)return c(ge,{role:"button",name:o.closeIcon,class:[x("close-icon",o.closeIconPosition),de],onClick:m},null)},T=()=>l("closed"),b=(a,d)=>{var u;return(u=e.value)==null?void 0:u.swipeTo(a,d)};return te({swipeTo:b}),xe(w),X([re,me],w),X(()=>o.startPosition,a=>v(+a)),X(()=>o.show,a=>{const{images:d,startPosition:u}=o;a?(v(+u),Ie(()=>{w(),b(+u,{immediate:!0})})):l("close",{index:s.active,url:d[s.active]})}),()=>c(ae,j({class:[x(),o.className],overlayClass:[x("overlay"),o.overlayClass],onClosed:T,"onUpdate:show":Y},ue(o,be)),{default:()=>[S(),P(),y(),C()]})}});let E;const Xe={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function Ye(){({instance:E}=se({setup(){const{state:o,toggle:l}=ne(),r=()=>{o.images=[]};return()=>c(Ze,j(o,{onClosed:r,"onUpdate:show":l}),null)}}))}const We=(o,l=0)=>{if(fe)return E||Ye(),o=Array.isArray(o)?{images:o,startPosition:l}:o,E.open(he({},Xe,o)),E};export{We as s};
